import{x as a,n as e,y as t,q as l,r as s,o,d,w as u,i,c as n,e as r,z as c,h as v,A as b,v as p}from"./index-om00KmGp.js";import{u as S}from"./useFormState-BETjqvZH.js";const m={class:"flex gap-2 items-center"},y=i("span",null,"数据源：",-1),g=i("span",{class:"ml-4"},"数据库：",-1),N=i("span",{class:"ml-4"},"表名称：",-1),w={__name:"baseTableSet",setup(w){const{formState:f,setFormState:h,resetFormState:k}=S({dataSource:void 0,database:void 0,tableName:void 0}),x=e([]),C=async()=>{const e=await(e=>a.post("/biSetting/baseSetting/listDataSource",e))(),{code:t,data:l}=e;t||(x.value=l)},_=e([]),I=e(!1),F=async()=>{if(!f.dataSource)return _.value=[],void(f.database=void 0);I.value=!0;const e=await(e=>a.post("/biSetting/baseSetting/listDatabase",e))({dataSourceId:f.dataSource}),{code:t,data:l}=e;t||(I.value=!1,_.value=l)},T=e(!1),D=e({}),L=t((()=>{var a,e;return T.value&&(!(null==(a=D.value)?void 0:a.id)||0===(null==(e=D.value)?void 0:e.status))})),P=t((()=>{var a,e;return T.value&&(null==(a=D.value)?void 0:a.id)&&1===(null==(e=D.value)?void 0:e.status)})),U=()=>{T.value=!1,D.value={},z.value=[],A.value=[]},j=async()=>{const e=await(e=>a.post("/biSetting/baseSetting/checkTable",e))({dataSourceId:f.dataSource,databaseName:f.database,tableName:f.tableName}),{code:t,data:l}=e;t||(p.success("检测成功, 自动预览数据"),D.value=l,T.value=!0,K())},M=async e=>{var t;if(null==(t=D.value)?void 0:t.id){const t=await(e=>a.post("/biSetting/baseSetting/enableSyncTable",e))({id:D.value.id,status:e}),{code:l,data:s}=t;l||(p.success(1===e?"启用同步成功":"取消同步成功"),D.value.status=e)}else{const e=await(e=>a.post("/biSetting/baseSetting/syncTable",e))({dataSourceId:f.dataSource,databaseName:f.database,tableName:f.tableName}),{code:t,data:l}=e;t||(p.success("同步任务成功"),D.value=l)}},q=async()=>{var e;await(e={dataSourceId:f.dataSource,databaseName:f.database,tableName:f.tableName},a.fileDownload("/biSetting/baseSetting/export",e))},z=e([]),A=e([]),H=e(!1),K=async()=>{const e=await(e=>a.post("/biSetting/baseSetting/preview",e))({dataSourceId:f.dataSource,databaseName:f.database,tableName:f.tableName}),{code:t,data:l}=e;t||(z.value=l.headerList.map((a=>({title:a,dataIndex:a,key:a}))),A.value=l.dataMapList)};return l((()=>{C()})),(a,e)=>{const t=s("a-select"),l=s("a-input"),p=s("a-button"),S=s("a-table"),w=s("ListPage");return o(),d(w,null,{tableTitle:u((()=>[i("div",m,[y,n(t,{placeholder:"请选择",value:r(f).dataSource,"onUpdate:value":e[0]||(e[0]=a=>r(f).dataSource=a),style:{width:"200px"},allowClear:"",showSearch:"",options:x.value,onChange:F,fieldNames:{label:"dataSourceName",value:"id"},optionFilterProp:"dataSourceName"},null,8,["value","options"]),g,n(t,{placeholder:"请选择",value:r(f).database,"onUpdate:value":e[1]||(e[1]=a=>r(f).database=a),style:{width:"200px"},allowClear:"",showSearch:"",options:_.value,disabled:!r(f).dataSource,fieldNames:{label:"databaseName",value:"id"},optionFilterProp:"databaseName",loading:I.value},null,8,["value","options","disabled","loading"]),N,n(l,{placeholder:"请输入",value:r(f).tableName,"onUpdate:value":e[2]||(e[2]=a=>r(f).tableName=a),valueModifiers:{trim:!0},allowClear:"",style:{width:"200px"},onKeyup:c(j,["enter"]),onChange:U},null,8,["value"]),n(p,{type:"primary",onClick:j,disabled:!r(f).database||!r(f).tableName},{default:u((()=>[v(" 检测")])),_:1},8,["disabled"])])])),actions:u((()=>[L.value?(o(),d(p,{key:0,type:"primary",onClick:e[3]||(e[3]=a=>M(1))},{default:u((()=>[v(" 同步 ")])),_:1})):b("",!0),P.value?(o(),d(p,{key:1,type:"primary",onClick:e[4]||(e[4]=a=>M(0))},{default:u((()=>[v(" 取消同步 ")])),_:1})):b("",!0),T.value?(o(),d(p,{key:2,type:"default",onClick:e[5]||(e[5]=a=>q())},{default:u((()=>[v(" 导出 ")])),_:1})):b("",!0)])),table:u((({scrollHeight:a})=>[n(S,{loading:H.value,columns:z.value,dataSource:A.value,scroll:{y:a-136}},null,8,["loading","columns","dataSource","scroll"])])),_:1})}}};export{w as default};
