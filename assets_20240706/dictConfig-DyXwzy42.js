import{u as e}from"./useFormState-BETjqvZH.js";import{q as a,r as t,o as l,d,w as n,c as o,h as i,e as s,y as u,n as c,P as r,i as m,A as v,v as p,D as f,p as y,j as k,t as b,z as h,R as g,f as x,Q as _,F as I,S as w}from"./index-om00KmGp.js";import{s as T,a as C,b as S,g as U,l as M,e as N}from"./dict-By4nYFNH.js";import{_ as F}from"./_plugin-vue_export-helper-BCo6x5W8.js";const L={__name:"search",emits:["search","reset"],setup(u,{expose:c,emit:r}){const m=r,{formState:v,setFormState:p,resetFormState:f}=e({status:1,type:1}),y=()=>{m("search",v)},k=()=>{f(),m("reset",v)};return c({doSearch:y}),a((()=>{k()})),(e,a)=>{const u=t("a-select-option"),c=t("a-select"),r=t("SearchContainer");return l(),d(r,{labelWidth:"60",limitRows:"1",onSearch:y,onReset:k},{default:n((()=>[o(c,{label:"状态",placeholder:"请选择",value:s(v).status,"onUpdate:value":a[0]||(a[0]=e=>s(v).status=e),allowClear:""},{default:n((()=>[o(u,{value:1},{default:n((()=>[i("启用")])),_:1}),o(u,{value:0},{default:n((()=>[i("停用")])),_:1})])),_:1},8,["value"])])),_:1})}}},R=e=>(y("data-v-bec91ea1"),e=e(),k(),e),D=R((()=>m("div",{class:"title"},"基本信息",-1))),O={class:"flex gap-x-2"},j=R((()=>m("div",{class:"title"},"数据项",-1))),q={class:"flex"},Y={class:"pl-4"},z=F({__name:"addDictModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(a,{emit:y}){const k=a,b=y,h=u({get:()=>k.visible,set(e){b("update:visible",e)}}),g=c(null),{formState:x,patchFormState:_,resetFormState:I}=e({id:void 0,sysDefaultTag:0,tableName:void 0,tableRemark:void 0,columns:[{columnId:void 0,columnName:void 0,columnType:void 0,length:void 0,pkTag:!1}]}),w=()=>{g.value.validate().then((async(e,a)=>{if(!e)return g.value.focusFirstField(),!1;{x.columns=x.columns.map((e=>({...e,pkTag:e.pkTag?1:0})));const e=await T(x),{code:a,data:t}=e;a||(k.id?(p.success("保存成功"),b("afterSave"),S()):f.confirm({title:"提示",content:"保存成功，是否继续维护字典内容？",okText:"继续",cancelText:"取消",onOk(){b("afterSave",t.id),S()},onCancel(){b("afterSave"),S()}}))}})).catch((e=>{}))},S=()=>{I(),h.value=!1},U=c(!1);r((()=>k.id),(async e=>{if(!k.visible)return void I();U.value=!0;const a=await C({id:e}),{code:t,data:l}=a;t||_(l),U.value=!1}));const M=[{title:"名称",dataIndex:"columnName",key:"columnName",width:150},{title:"类型",dataIndex:"columnType",key:"columnType",width:150},{title:"长度",dataIndex:"length",key:"length",width:150},{title:"是否主键",dataIndex:"pkTag",key:"pkTag",width:150},{title:"操作",dataIndex:"action",key:"action",width:150}];return(e,u)=>{const c=t("a-input"),r=t("a-form-item"),p=t("a-button"),f=t("a-select-option"),y=t("a-select"),k=t("a-input-number"),b=t("a-checkbox"),_=t("a-table"),I=t("a-form"),T=t("a-modal");return l(),d(T,{visible:h.value,"onUpdate:visible":u[2]||(u[2]=e=>h.value=e),title:a.id?"编辑字典":"新增字典",onOk:w,onCancel:S,okText:"保存",width:"60%",destroyOnClose:!0,maskClosable:!1},{default:n((()=>[o(I,{ref_key:"dictForm",ref:g,model:s(x),name:"dictMeta","label-col":{style:{width:"80px"}},autocomplete:"off",layout:"horizontal"},{default:n((()=>[D,m("div",O,[o(r,{label:"字典名称",name:"tableName",rules:[{required:!0,message:"请输入名称",trigger:"blur"}]},{default:n((()=>[o(c,{value:s(x).tableName,"onUpdate:value":u[0]||(u[0]=e=>s(x).tableName=e),placeholder:"请输入",style:{width:"250px"}},null,8,["value"])])),_:1}),o(r,{label:"字典说明",name:"tableRemark"},{default:n((()=>[o(c,{value:s(x).tableRemark,"onUpdate:value":u[1]||(u[1]=e=>s(x).tableRemark=e),placeholder:"请输入",style:{width:"450px"}},null,8,["value"])])),_:1})]),j,o(_,{size:"small",columns:M,"data-source":s(x).columns,pagination:!1,"row-key":e=>e.id,scroll:{y:500},loading:U.value},{bodyCell:n((({column:e,text:a,record:t,index:u})=>["action"===e.dataIndex?(l(),d(r,{key:0},{default:n((()=>[m("div",q,[o(p,{type:"text",style:{color:"#1890ff"},onClick:e=>(e=>{x.columns.splice(e+1,0,{columnId:void 0,columnName:void 0,columnType:void 0,length:void 0,pkTag:!1})})(u)},{default:n((()=>[i(" 新增 ")])),_:2},1032,["onClick"]),o(p,{type:"text",style:{color:"#f50120"},onClick:e=>(e=>{x.columns.splice(e,1)})(u),disabled:1===s(x).columns.length},{default:n((()=>[i(" 删除 ")])),_:2},1032,["onClick","disabled"])])])),_:2},1024)):"columnName"===e.dataIndex?(l(),d(r,{key:1,label:"",name:["columns",u,"columnName"],rules:[{required:!0,message:"请输入名称",trigger:"blur"}]},{default:n((()=>[o(c,{value:t.columnName,"onUpdate:value":e=>t.columnName=e,placeholder:"请输入",allowClear:""},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])):"columnType"===e.dataIndex?(l(),d(r,{key:2,label:"",name:["columns",u,"columnType"],rules:[{required:!0,message:"请选择类型",trigger:"blur"}]},{default:n((()=>[o(y,{placeholder:"请选择",value:t.columnType,"onUpdate:value":e=>t.columnType=e,allowClear:""},{default:n((()=>[o(f,{value:2},{default:n((()=>[i("字符")])),_:1}),o(f,{value:1},{default:n((()=>[i("数字")])),_:1}),o(f,{value:3},{default:n((()=>[i("日期")])),_:1})])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["name"])):"length"===e.dataIndex?(l(),d(r,{key:3,label:"",name:["columns",u,"length"],rules:[{required:!0,message:"请输入长度",trigger:"blur"}]},{default:n((()=>[o(k,{value:t.length,"onUpdate:value":e=>t.length=e,placeholder:"请输入",class:"w-full"},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])):"pkTag"===e.dataIndex?(l(),d(r,{key:4,label:"",name:["columns",u,"pkTag"],rules:[{required:!0,message:"请选择是否主键",trigger:"blur"}]},{default:n((()=>[m("div",Y,[o(b,{checked:t.pkTag,"onUpdate:checked":e=>t.pkTag=e,class:"m-auto"},null,8,["checked","onUpdate:checked"])])])),_:2},1032,["name"])):v("",!0)])),_:1},8,["data-source","row-key","loading"])])),_:1},8,["model"])])),_:1},8,["visible","title"])}}},[["__scopeId","data-v-bec91ea1"]]),A={class:"flex"},K=F({__name:"addDictItemModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(a,{emit:v}){const f=a,y=v,k=u({get:()=>f.visible,set(e){y("update:visible",e)}}),x=c(null),_=c(null),I=e=>{M.dataMapList.splice(e+1,0,Object.fromEntries(M.headerList.map((e=>[e.name,void 0])))),g((()=>{document.querySelectorAll("#editableInput")[(L.value.length-2)*(e+1)].focus()}))},w=async()=>{M.dataMapList.filter((e=>Object.keys(e).length)).length?x.value.validate().then((async(e,a)=>{if(!e)return x.value.focusFirstField(),!1;{const e=await S({dataMapList:M.dataMapList,id:f.id}),{code:a}=e;a||(p.success("保存成功"),y("afterSave"),T())}})).catch((e=>{})):p.warning("请至少输入一条数据")},T=()=>{F(),k.value=!1},C=(e,a)=>{a!==L.value[L.value.length-2].dataIndex||I(e)},{formState:M,patchFormState:N,resetFormState:F}=e({id:void 0,tableName:void 0,headerList:void 0,dataMapList:[]}),L=c([]),R=c(!1);return r((()=>f.id),(async e=>{if(!f.visible)return;R.value=!0;const a=await U({id:e}),{code:t,data:l}=a;t||(L.value=[{title:"序号",dataIndex:"index",key:"index",width:60,ellipsis:!0},...l.headerList.map((e=>({title:e.name,dataIndex:e.name,key:e.name,width:200,ellipsis:!0,type:e.type}))),{title:"操作",dataIndex:"action",key:"action",width:200}],N(l),!l.dataMapList.length&&I(-1)),R.value=!1})),(e,a)=>{const u=t("a-form-item"),c=t("a-button"),r=t("a-input"),v=t("a-date-picker"),p=t("a-table"),f=t("a-form"),y=t("a-modal");return l(),d(y,{visible:k.value,"onUpdate:visible":a[0]||(a[0]=e=>k.value=e),title:"编辑字典内容",onOk:w,onCancel:T,okText:"保存",width:"60%",destroyOnClose:!0,maskClosable:!1},{default:n((()=>[o(f,{ref_key:"dictForm",ref:x,model:s(M),name:"dictItem","label-col":{style:{width:"80px"}},autocomplete:"off",layout:"horizontal"},{default:n((()=>[o(p,{size:"small",columns:L.value,"data-source":s(M).dataMapList,pagination:!1,scroll:{y:500},loading:R.value},{bodyCell:n((({column:e,text:a,record:t,index:p})=>["index"===e.dataIndex?(l(),d(u,{key:0},{default:n((()=>[i(b(p+1),1)])),_:2},1024)):"action"===e.dataIndex?(l(),d(u,{key:1},{default:n((()=>[m("div",A,[o(c,{type:"text",style:{color:"#1890ff"},onClick:e=>I(p)},{default:n((()=>[i(" 新增 ")])),_:2},1032,["onClick"]),o(c,{type:"text",style:{color:"#f50120"},onClick:e=>(e=>{M.dataMapList.splice(e,1)})(p),disabled:1===s(M).dataMapList.length},{default:n((()=>[i(" 删除 ")])),_:2},1032,["onClick","disabled"])])])),_:2},1024)):(l(),d(u,{key:2,name:["dataMapList",p,e.dataIndex],rules:[{required:Object.keys(t).length,message:"请输入",trigger:"blur"}]},{default:n((()=>[3!==e.type?(l(),d(r,{key:0,id:"editableInput",ref_key:"editableInputRef",ref:_,value:t[e.dataIndex],"onUpdate:value":a=>t[e.dataIndex]=a,placeholder:"请输入",allowClear:"",onKeydown:h((a=>C(p,e.dataIndex)),["enter"])},null,8,["value","onUpdate:value","onKeydown"])):(l(),d(v,{key:1,class:"w-full",value:t[e.dataIndex],"onUpdate:value":a=>t[e.dataIndex]=a,placeholder:"请选择",onKeydown:h((a=>C(p,e.dataIndex)),["enter"]),format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"},null,8,["value","onUpdate:value","onKeydown"]))])),_:2},1032,["name","rules"]))])),_:1},8,["columns","data-source","loading"])])),_:1},8,["model"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-48ba1890"]]),B={__name:"dictConfig",setup(e){const a=c([]),d=c(!1),s=c(),u=async e=>{d.value=!0;const t=await M(e),{code:l,data:n}=t;l||(a.value=n,d.value=!1)},m=e=>{u(e)},v=(e={})=>{u(e)},y=c(null),k=c(!1),b=c(!1),h=()=>{k.value=!0},T=e=>{s.value.doSearch(),g((()=>{e&&(y.value=e,b.value=!0)}))};r([k,b],(e=>{e[0]||e[1]||(y.value=null)}));const C=[{title:"字典名称",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",customRender:e=>o(w,{checked:e.value,onChange:async a=>{f.confirm({title:"提示",content:"确定要"+(a?"启用":"禁用")+"该字典吗？",onOk:async()=>{(await N({ids:[e.record.id],status:a?1:0})).code||(p.success("操作成功"),e.record.status=a?1:0,f.destroyAll(),T())}})},checkedValue:1,unCheckedValue:0,disabled:1===e.record.sysDefaultTag},null)},{title:"创建人",dataIndex:"createUserName",key:"createUserName"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"修改人",dataIndex:"updateUserName",key:"updateUserName"},{title:"修改时间",dataIndex:"updateTime",key:"updateTime"},{title:"元数据操作",dataIndex:"metaAction",key:"updateTime",customRender:e=>o("div",{class:"flex flex-row gap-2"},[o(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{y.value=e.id,k.value=!0})(e)},{default:()=>[i("编辑")]})])},{title:"数据项操作",dataIndex:"action",key:"action",customRender:e=>o("div",{class:"flex flex-row gap-2"},[o(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{y.value=e.id,b.value=!0})(e)},{default:()=>[i("编辑")]})])}];return(e,u)=>{const c=t("a-button");return l(),x(I,null,[o(_,{columns:C,tableTitle:"字典列表",tableData:a.value,loading:d.value},{search:n((()=>[o(L,{ref_key:"searchRef",ref:s,onSearch:m,onReset:v},null,512)])),actions:n((()=>[o(c,{type:"primary",onClick:h},{default:n((()=>[i("新增字典")])),_:1})])),_:1},8,["tableData","loading"]),o(z,{visible:k.value,"onUpdate:visible":u[0]||(u[0]=e=>k.value=e),onAfterSave:T,id:y.value},null,8,["visible","id"]),o(K,{visible:b.value,"onUpdate:visible":u[1]||(u[1]=e=>b.value=e),onAfterSave:T,id:y.value},null,8,["visible","id"])],64)}}};export{B as default};
