import{u as e}from"./useFormState-dDzhB8YD.js";import{c as a,b as l,m as t,q as o,u}from"./employee-D9V7PQ_e.js";import{n as s,q as i,r as n,o as r,d as c,w as d,c as m,h as v,e as p,i as b,f,g as k,F as y,v as N,t as h,y as _,U as w,p as g,j as S,Q as x}from"./index-DlcaZKbg.js";import{_ as C}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{l as I}from"./dept-Z314R_OJ.js";const T={style:{width:"160px"}},F=b("div",null,null,-1),U=b("div",null,null,-1),V={__name:"search",emits:["search","reset","preview","autoMatch"],setup(l,{expose:t,emit:o}){const u=o,{formState:_,setFormState:w,resetFormState:g}=e({tableName:"",columnName:"",pkName:""}),S=()=>{u("search",_)},x=()=>{g(),u("reset",_)},C=()=>{u("autoMatch",_)},I=s(!1),V=s([]),j=async()=>{if(I.value=!0,_.tableName){const{data:e,code:l}=await a({tableName:_.tableName});l?V.value=[]:(V.value=e,N.success(`${_.tableName}表存在`)),I.value=!1}else I.value=!1,N.info("请输入表名后再检测")},R=()=>{u("preview",V.value)};return t({doSearch:S,formState:_}),i((()=>{})),(e,a)=>{const l=n("a-input"),t=n("a-button"),o=n("a-select-option"),u=n("a-select"),s=n("SearchContainer");return r(),c(s,{labelWidth:"100",limitRows:"1",onSearch:S,onReset:x,noCollapse:""},{action:d((()=>[m(t,{onClick:C},{default:d((()=>[v("自动匹配")])),_:1}),m(t,{onClick:x},{default:d((()=>[v("重置")])),_:1}),m(t,{type:"primary",onClick:S},{default:d((()=>[v("查询")])),_:1})])),default:d((()=>[m(l,{label:"表名",placeholder:"请输入",value:p(_).tableName,"onUpdate:value":a[0]||(a[0]=e=>p(_).tableName=e),allowClear:""},null,8,["value"]),b("div",T,[m(t,{onClick:j,loading:I.value},{default:d((()=>[v("检测")])),_:1},8,["loading"]),m(t,{style:{"margin-left":"10px"},disabled:0===V.value.length,onClick:R},{default:d((()=>[v("预览")])),_:1},8,["disabled"])]),F,U,m(u,{label:"主键字段名",placeholder:"请选择",value:p(_).pkName,"onUpdate:value":a[1]||(a[1]=e=>p(_).pkName=e),allowClear:""},{default:d((()=>[(r(!0),f(y,null,k(V.value,(e=>(r(),c(o,{key:`pkName${e.columnName}`,value:e.columnName},{default:d((()=>[v(h(e.columnName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),m(u,{label:"字段名",placeholder:"请选择",value:p(_).columnName,"onUpdate:value":a[2]||(a[2]=e=>p(_).columnName=e),allowClear:""},{default:d((()=>[(r(!0),f(y,null,k(V.value,(e=>(r(),c(o,{key:`columnName${e.columnName}`,value:e.columnName},{default:d((()=>[v(h(e.columnName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})}}},j=C({__name:"previewTable",props:{list:{type:Array,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(e,{emit:a}){const l=e,t=a,o=_({get:()=>l.visible,set(e){t("update:visible",e)}});w((()=>{}));const u=[{title:"字段名称",dataIndex:"columnName",key:"columnName"},{title:"字段长度",dataIndex:"columnSize",key:"columnSize"},{title:"字段类型",dataIndex:"columnType",key:"columnType"},{title:"字段备注",dataIndex:"remark",key:"remark"}];return(a,l)=>{const t=n("a-table"),s=n("a-modal");return r(),c(s,{visible:o.value,"onUpdate:visible":l[0]||(l[0]=e=>o.value=e),title:"预览",footer:null,width:"60%",destroyOnClose:!0,maskClosable:!1},{default:d((()=>[m(t,{columns:u,"data-source":e.list,"row-key":e=>e.id,pagination:!1,scroll:{y:400},rowSelection:a.rowSelection,class:"mb-4"},null,8,["data-source","row-key","rowSelection"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-5149e0a5"]]),R=(e=>(g("data-v-51191722"),e=e(),S(),e))((()=>b("div",{class:"title"},"对照",-1))),M={class:"grid grid-cols-1 gap-0"},z=C({__name:"compareModel",props:{compareValue:{type:Object,default:void 0},visible:{type:Boolean,default:!1}},emits:["matchTable"],setup(a,{emit:l}){const t=a,o=l,u=_({get:()=>t.visible,set(e){o("update:visible",e)}}),v=s(null),f=s({id:[{required:!0,message:"请选择部门",trigger:"blur"}]}),k=s([]),y=()=>{v.value.validate().then((async(e,a)=>{if(!e)return v.value.focusFirstField(),!1;{let e={localPkValue:h.id,tableName:t.compareValue.tableName,pkValue:t.compareValue.pk};o("match",e)}})).catch((e=>{}))},N=()=>{g(),u.value=!1,h.id=""},{formState:h,patchFormState:w,resetFormState:g}=e({id:void 0,name:void 0,description:void 0});return i((()=>{(async()=>{const{data:e}=await I();k.value=e||[]})()})),(e,a)=>{const l=n("a-tree-select"),t=n("a-form-item"),o=n("a-form"),s=n("a-modal");return r(),c(s,{visible:u.value,"onUpdate:visible":a[1]||(a[1]=e=>u.value=e),title:"对照",onOk:y,onCancel:N,okText:"对照",width:"40%",destroyOnClose:!0,maskClosable:!1},{default:d((()=>[m(o,{ref_key:"wordForm",ref:v,model:p(h),name:"compareVal","label-col":{style:{width:"80px"}},"wrapper-col":{span:16},autocomplete:"off",rules:f.value},{default:d((()=>[R,b("div",M,[m(t,{label:"选择部门",name:"id"},{default:d((()=>[m(l,{label:"部门名称",value:p(h).id,"onUpdate:value":a[0]||(a[0]=e=>p(h).id=e),style:{width:"100%"},"tree-data":k.value,fieldNames:{label:"deptName",value:"id",children:"children"},"allow-clear":"","search-placeholder":"请选择"},null,8,["value","tree-data"])])),_:1})])])),_:1},8,["model","rules"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-51191722"]]),O={__name:"index",setup(e){const a=s([]),i=s(!1),c=s(),p=async e=>{if(e.tableName&&e.columnName&&e.pkName){i.value=!0;try{const l=await o(e),{code:t,data:u}=l;t?N.error(l.msg):a.value=u||[],i.value=!1}catch(l){a.value=[],N.error("获取数据失败"),i.value=!1}}else N.info("请先填入表名、字段名、主键名")},b=e=>{p(e)},k=(e={})=>{p(e)},h=async e=>{if(e.tableName&&e.columnName&&e.pkName){let a={columnName:e.columnName,pkName:e.pkName,tableName:e.tableName};const{data:t,code:o}=await l(a);b(a),o||N.success("自动匹配成功")}else N.info("请先填入表名、字段名、主键名")};s(null);const _=s(!1),w=s([]),g=e=>{w.value=e||[],_.value=!0},S=async e=>{let a={...e,pkName:c.value.formState.pkName,columnName:c.value.formState.columnName};const l=await t(a),{code:o}=l;o||(C.value=!1,N.success("对照成功"),c.value.doSearch())},C=s(!1),I=s({}),T=[{title:"表名",dataIndex:"tableName",key:"tableName"},{title:"主键",dataIndex:"pk",key:"pk"},{title:"字段名",dataIndex:"column",key:"column"},{title:"本地主键",dataIndex:"localPk",key:"localPk"},{title:"本地字段名",dataIndex:"localColumn",key:"localColumn"},{title:"匹配状态",dataIndex:"refTag",key:"refTag",customRender:({record:e})=>m("span",null,[1===e.refTag?"已对照":"未对照"])},{title:"操作",dataIndex:"action",key:"action",customRender:e=>0==e.record.refTag?m("div",{class:"flex flex-row gap-2"},[m(n("a-button"),{type:"link",size:"small",onClick:()=>(async({record:e})=>{I.value=e,C.value=!0})(e)},{default:()=>[v("对照")]})]):1==e.record.refTag?m(n("a-button"),{type:"link",size:"small",onClick:()=>(async({record:e})=>{let{data:a,code:l}=await u({pkValue:e.pk,tableName:e.tableName});l?N.error(a.msg):(N.success("取消对照成功"),c.value.doSearch())})(e),disabled:0===e.record.id},{default:()=>[v("取消对照")]}):void 0}];return(e,l)=>(r(),f(y,null,[m(x,{columns:T,tableTitle:"人员对照",tableData:a.value,loading:i.value},{search:d((()=>[m(V,{ref_key:"compareSearchRef",ref:c,onSearch:b,onReset:k,onPreview:g,onAutoMatch:h},null,512)])),_:1},8,["tableData","loading"]),m(j,{visible:_.value,"onUpdate:visible":l[0]||(l[0]=e=>_.value=e),list:w.value},null,8,["visible","list"]),m(z,{visible:C.value,"onUpdate:visible":l[1]||(l[1]=e=>C.value=e),compareValue:I.value,onMatch:S},null,8,["visible","compareValue"])],64))}};export{O as default};
