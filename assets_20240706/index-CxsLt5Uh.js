import{y as e,n as a,O as l,P as t,r as d,o as u,d as o,w as i,c as n,i as s,e as r,f as v,g as p,F as c,v as m,h as y,t as f,A as b,p as h,j as k,q as _,Q as w,S as g,D as x}from"./index-DlcaZKbg.js";import{u as U}from"./useFormState-dDzhB8YD.js";import{l as I}from"./dept-Z314R_OJ.js";import{l as T}from"./extProp-Cazlnwrg.js";import{g as N}from"./dict-D7SstXxP.js";import{s as A,g as C,l as P,a as M,e as S}from"./employee-D9V7PQ_e.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";const F=e=>(h("data-v-9f4cbe83"),e=e(),k(),e),L=F((()=>s("div",{class:"title"},"人员信息",-1))),D={class:"grid grid-cols-2 gap-0"},O=F((()=>s("div",{class:"title"},"扩展信息",-1))),Y={class:"grid grid-cols-2 gap-0"},q=j({__name:"addPersonModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(h,{emit:k}){const _=h,w=k,g=e({get:()=>_.visible,set(e){w("update:visible",e)}}),x=a(null),M=a({name:[{required:!0,message:"请填写姓名",trigger:"blur"}],deptId:[{required:!0,message:"请选择归属部门",trigger:"change"}]});let S=a([]);const j=()=>{S.value&&S.value.length&&(S.value=S.value.map((e=>({...e,value:""}))))},F=a([]),q=a([]),K=a([]),R=a([]),V=a([]),z=a([]),B=a([]),E=a([]),Q=()=>{x.value.validate().then((async(e,a)=>{if(!e)return x.value.focusFirstField(),!1;{let e=Z;e.extPropInfos=S.value.map((e=>({extPropId:e.id,name:e.name,value:e.value})));const a=await A(e),{code:l}=a;l||(m.success("保存成功"),w("afterSave"),X())}})).catch((e=>{}))},X=()=>{H(),j(),g.value=!1},{formState:Z,patchFormState:G,resetFormState:H}=U({name:void 0,deptId:void 0,idNo:void 0,mobile:void 0,bankCardNo:void 0,ethnicity:void 0,manageType:void 0,personType:void 0,political:void 0,position:void 0,workType:void 0});return l((()=>{(async()=>{const{data:e}=await I();E.value=e||[]})(),(async()=>{S.value=[];const{data:e}=await T({type:2,status:1});S.value=e||[],j()})(),(async()=>{const{data:e,code:a}=await P();B.value=e||[]})(),(async()=>{const{data:e,code:a}=await N({id:2});a||(F.value=e.dataMapList||[])})(),(async()=>{const{data:e,code:a}=await N({id:3});a||(q.value=e.dataMapList||[])})(),(async()=>{const{data:e,code:a}=await N({id:4});a||(K.value=e.dataMapList||[])})(),(async()=>{const{data:e,code:a}=await N({id:5});a||(R.value=e.dataMapList||[])})(),(async()=>{const{data:e,code:a}=await N({id:6});a||(V.value=e.dataMapList||[])})(),(async()=>{const{data:e,code:a}=await N({id:7});a||(z.value=e.dataMapList||[])})()})),t((()=>_.id),(async e=>{if(e){const a=await C({uuid:e}),{code:l,data:t}=a;l||(G(t),t.extPropInfos&&t.extPropInfos.length&&(S.value=((e,a)=>{let l=new Map;for(let t of e)l.set(t.id,{...t});for(let t of a)l.has(t.extPropId)&&l.set(t.extPropId,Object.assign(l.get(t.extPropId),{value:t.value}));return Array.from(l.values())})(S.value,t.extPropInfos)))}}),{immediate:!0}),(e,a)=>{const l=d("a-input"),t=d("a-form-item"),m=d("a-tree-select"),k=d("a-select-option"),_=d("a-select"),w=d("a-date-picker"),U=d("a-form"),I=d("a-modal");return u(),o(I,{visible:g.value,"onUpdate:visible":a[11]||(a[11]=e=>g.value=e),title:""+(h.id?"修改部门":"新增部门"),onOk:Q,onCancel:X,okText:"保存",width:"60%",destroyOnClose:!0,maskClosable:!1,bodyStyle:{height:"70vh"}},{default:i((()=>[n(U,{ref_key:"personForm",ref:x,model:r(Z),name:"personForm","label-col":{style:{width:"120px"}},"wrapper-col":{span:16},autocomplete:"off",rules:M.value},{default:i((()=>[L,s("div",D,[n(t,{label:"姓名",name:"name"},{default:i((()=>[n(l,{value:r(Z).name,"onUpdate:value":a[0]||(a[0]=e=>r(Z).name=e)},null,8,["value"])])),_:1}),n(t,{label:"归属部门",name:"deptId"},{default:i((()=>[n(m,{label:"部门名称",value:r(Z).deptId,"onUpdate:value":a[1]||(a[1]=e=>r(Z).deptId=e),style:{width:"100%"},"tree-data":E.value,fieldNames:{label:"deptName",value:"id",children:"children"},"allow-clear":"","search-placeholder":"请选择"},null,8,["value","tree-data"])])),_:1}),n(t,{label:"身份证",name:"idNo"},{default:i((()=>[n(l,{value:r(Z).idNo,"onUpdate:value":a[2]||(a[2]=e=>r(Z).idNo=e)},null,8,["value"])])),_:1}),n(t,{label:"手机号",name:"mobile"},{default:i((()=>[n(l,{value:r(Z).mobile,"onUpdate:value":a[3]||(a[3]=e=>r(Z).mobile=e)},null,8,["value"])])),_:1}),n(t,{label:"银行卡号",name:"bankCardNo"},{default:i((()=>[n(l,{value:r(Z).bankCardNo,"onUpdate:value":a[4]||(a[4]=e=>r(Z).bankCardNo=e)},null,8,["value"])])),_:1}),n(t,{label:"民族",name:"ethnicity"},{default:i((()=>[n(_,{value:r(Z).ethnicity,"onUpdate:value":a[5]||(a[5]=e=>r(Z).ethnicity=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(R.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(t,{label:"管理类别",name:"manageType"},{default:i((()=>[n(_,{value:r(Z).manageType,"onUpdate:value":a[6]||(a[6]=e=>r(Z).manageType=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(z.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(t,{label:"人员性质",name:"personType"},{default:i((()=>[n(_,{value:r(Z).personType,"onUpdate:value":a[7]||(a[7]=e=>r(Z).personType=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(F.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(t,{label:"政治面貌",name:"political"},{default:i((()=>[n(_,{value:r(Z).political,"onUpdate:value":a[8]||(a[8]=e=>r(Z).political=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(K.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(t,{label:"行政职务",name:"position"},{default:i((()=>[n(_,{value:r(Z).position,"onUpdate:value":a[9]||(a[9]=e=>r(Z).position=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(V.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),n(t,{label:"工作种类",name:"workType"},{default:i((()=>[n(_,{value:r(Z).workType,"onUpdate:value":a[10]||(a[10]=e=>r(Z).workType=e),placeholder:"请选择",showArrow:""},{default:i((()=>[(u(!0),v(c,null,p(q.value,(e=>(u(),o(k,{key:e.id,value:e.id},{default:i((()=>[y(f(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})]),O,s("div",Y,[(u(!0),v(c,null,p(r(S),(e=>(u(),o(t,{key:e.id,label:e.name},{default:i((()=>[1==e.propType?(u(),o(l,{key:0,type:"number",value:e.value,"onUpdate:value":a=>e.value=a},null,8,["value","onUpdate:value"])):2==e.propType?(u(),o(l,{key:1,value:e.value,"onUpdate:value":a=>e.value=a},null,8,["value","onUpdate:value"])):3==e.propType?(u(),o(w,{key:2,value:e.value,"onUpdate:value":a=>e.value=a,valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","onUpdate:value"])):b("",!0)])),_:2},1032,["label"])))),128))])])),_:1},8,["model","rules"])])),_:1},8,["visible","title"])}}},[["__scopeId","data-v-9f4cbe83"]]),K={__name:"index",setup(e){const l=a([]),s=a(!1),r=a(1),p=e=>{r.value=e,b()},f=e=>(e&&Array.isArray(e.children)&&(0===e.children.length?delete e.children:(e.children.forEach((e=>{f(e)})),0===e.children.length&&delete e.children)),e?e.children:[]),b=async()=>{if(l.value=[],s.value=!0,1===r.value){const e=await P({status:r.value}),{code:a,data:t}=e;a||(l.value=f({children:t}),s.value=!1)}else{const e=await M({status:r.value}),{code:a,data:t}=e;a||(l.value=t,s.value=!1)}},h=(e={})=>{b()},k=a(null),U=a(!1),I=()=>{U.value=!0},T=a(!1);t([U,T],((e,a)=>{e.includes(!0)||(k.value=null)}));const N=[{title:"部门名称/姓名",dataIndex:"name",key:"name"},{title:"行政职位",dataIndex:"positionName",key:"positionName"},{title:"电话号码",dataIndex:"mobile",key:"mobile"},{title:"状态",dataIndex:"status",key:"status",customRender:e=>{const a=async a=>{x.confirm({title:"提示",content:"确定要"+(a?"启用":"禁用")+"该人员吗？",onOk:async()=>{(await S({uuids:[e.record.id],status:a?1:0})).code||(m.success("操作成功"),e.record.status=a?1:0,x.destroyAll(),b())}})};return 2===e.record.type||0==r.value?n(g,{checked:e.value,onChange:a,checkedValue:1,unCheckedValue:0},null):"--"}},{title:"创建人",dataIndex:"createUserName",key:"createUserName"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"修改人",dataIndex:"updateUserName",key:"updateUserName"},{title:"修改时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",dataIndex:"action",key:"action",customRender:e=>n("div",{class:"flex flex-row gap-2"},[n(d("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{k.value=e.uuid,U.value=!0})(e),disabled:1===e.record.type},{default:()=>[y("编辑")]})])}];return _((()=>{b()})),(e,a)=>{const t=d("a-tab-pane"),m=d("a-tabs"),f=d("a-button");return u(),v(c,null,[n(w,{columns:N,tableData:l.value,loading:s.value},{tableTitle:i((()=>[n(m,{activeKey:r.value,"onUpdate:activeKey":a[0]||(a[0]=e=>r.value=e),onChange:p},{default:i((()=>[(u(),o(t,{key:1,tab:"启用中"})),(u(),o(t,{key:0,tab:"已停用"}))])),_:1},8,["activeKey"])])),actions:i((()=>[n(f,{type:"primary",onClick:I},{default:i((()=>[y("新增人员")])),_:1})])),_:1},8,["tableData","loading"]),n(q,{visible:U.value,"onUpdate:visible":a[1]||(a[1]=e=>U.value=e),onAfterSave:h,id:k.value},null,8,["visible","id"])],64)}}};export{K as default};
