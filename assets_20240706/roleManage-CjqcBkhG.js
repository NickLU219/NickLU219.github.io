import{u as e}from"./useFormState-BETjqvZH.js";import{q as a,r as t,o as l,d as s,w as i,c as d,e as o,h as n,y as u,n as r,P as c,i as v,V as m,v as p,W as f,p as b,j as y,U as k,A as _,D as x,X as h,f as w,Q as g,F as C,N as S,S as I,Y as U}from"./index-om00KmGp.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{l as F}from"./user-D7xRnA4w.js";const O={__name:"search",emits:["search","reset"],setup(u,{emit:r}){const c=r,{formState:v,setFormState:m,resetFormState:p}=e({name:void 0,status:void 0}),f=()=>{c("search",v)},b=()=>{p(),c("reset",v)};return a((()=>{b()})),(e,a)=>{const u=t("a-input"),r=t("a-select-option"),c=t("a-select"),m=t("SearchContainer");return l(),s(m,{labelWidth:"60",limitRows:"1",onSearch:f,onReset:b},{default:i((()=>[d(u,{label:"角色名",placeholder:"请输入",value:o(v).name,"onUpdate:value":a[0]||(a[0]=e=>o(v).name=e),allowClear:""},null,8,["value"]),d(c,{label:"状态",placeholder:"请选择",value:o(v).status,"onUpdate:value":a[1]||(a[1]=e=>o(v).status=e),allowClear:""},{default:i((()=>[d(r,{value:1},{default:i((()=>[n("启用")])),_:1}),d(r,{value:0},{default:i((()=>[n("禁用")])),_:1})])),_:1},8,["value"])])),_:1})}}},j=(e=>(b("data-v-0e5f73c2"),e=e(),y(),e))((()=>v("div",{class:"title"},"角色信息",-1))),T={class:"grid grid-cols-2 gap-0"},V=R({__name:"addRoleModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(a,{emit:n}){const b=a,y=n,k=u({get:()=>b.visible,set(e){y("update:visible",e)}}),_=r(null),x=async()=>{if(await _.value.validate()){const e=await m(w),{code:a}=e;a||(p.success("保存成功"),y("afterSave"),h())}},h=()=>{C(),k.value=!1},{formState:w,patchFormState:g,resetFormState:C}=e({id:void 0,name:void 0,description:void 0});return c((()=>b.id),(async e=>{if(e||0===e){const a=await f({id:e}),{code:t,data:l}=a;t||g(l)}}),{immediate:!0}),(e,a)=>{const n=t("a-input"),u=t("a-form-item"),r=t("a-textarea"),c=t("a-form"),m=t("a-modal");return l(),s(m,{visible:k.value,"onUpdate:visible":a[2]||(a[2]=e=>k.value=e),title:"新增角色",onOk:x,onCancel:h,okText:"保存",width:"60%",destroyOnClose:!0,maskClosable:!1},{default:i((()=>[d(c,{ref_key:"roleFormRef",ref:_,model:o(w),name:"role","label-col":{style:{width:"80px"}},"wrapper-col":{span:16},autocomplete:"off"},{default:i((()=>[j,v("div",T,[d(u,{label:"名称",name:"name",required:""},{default:i((()=>[d(n,{value:o(w).name,"onUpdate:value":a[0]||(a[0]=e=>o(w).name=e)},null,8,["value"])])),_:1}),d(u,{label:"描述",name:"description",class:"col-span-2"},{default:i((()=>[d(r,{value:o(w).description,"onUpdate:value":a[1]||(a[1]=e=>o(w).description=e)},null,8,["value"])])),_:1})])])),_:1},8,["model"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-0e5f73c2"]]),z={class:"flex flex-row-reverse gap-4 mb-4"},A=R({__name:"changeRoleUser",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(e,{emit:a}){const o=e,m=a,f=u({get:()=>o.visible,set(e){m("update:visible",e)}}),b=r([]),y=r([]),w={onChange:(e,a)=>{y.value=e}},g=()=>{},C=async e=>{x.confirm({title:"提示",content:"确定删除吗？",okText:"确定",cancelText:"取消",onOk:async()=>{const a=await h({roleId:o.id,userIds:e}),{code:t}=a;t||(p.success("删除成功"),b.value=b.value.filter((a=>!e.includes(a.id))))}})};c((()=>o.id),(async e=>{if(e||0===e){const a=await F({roleId:e}),{code:t,data:l}=a;t||(b.value=l.map(((e,a)=>({index:a+1,...e}))))}}),{immediate:!0}),k((()=>{}));const S=[{title:"序号",dataIndex:"index",key:"index"},{title:"账号",dataIndex:"account",key:"account"},{title:"姓名",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",customRender:e=>1===e.value?d("div",{class:"status-success"},[n("启用")]):d("div",{class:"status-error"},[n("禁用")])},{title:"说明",dataIndex:"remark",key:"remark"},{title:"操作",dataIndex:"action",key:"action"}];return(e,a)=>{const o=t("a-button"),u=t("a-table"),r=t("a-modal");return l(),s(r,{visible:f.value,"onUpdate:visible":a[1]||(a[1]=e=>f.value=e),title:"角色下账号列表",footer:null,width:"60%",destroyOnClose:!0,maskClosable:!1},{default:i((()=>[v("div",z,[d(o,{type:"primary",onClick:g},{default:i((()=>[n("新增")])),_:1}),d(o,{type:"danger",disabled:0===y.value.length,onClick:a[0]||(a[0]=()=>C(y.value))},{default:i((()=>[n("批量删除")])),_:1},8,["disabled"])]),d(u,{columns:S,"data-source":b.value,"row-key":e=>e.id,pagination:!1,scroll:{y:400},rowSelection:w,class:"mb-4"},{bodyCell:i((({column:e,record:a})=>["action"===e.dataIndex?(l(),s(o,{key:0,type:"link",size:"small",onClick:()=>C([a.id])},{default:i((()=>[n("删除")])),_:2},1032,["onClick"])):_("",!0)])),_:1},8,["data-source","row-key"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-5dbbf965"]]),D={__name:"roleManage",setup(e){const a=r([]),s=r(!1),o=async e=>{s.value=!0;const t=await S(),{code:l,data:i}=t;l||(a.value=i.filter((a=>{var t;return(null==(t=a.name)?void 0:t.indexOf(e.name))>-1||void 0===e.name})).filter((a=>a.status===e.status||void 0===e.status)),s.value=!1)},u=e=>{o(e)},v=(e={})=>{o(e)},m=r(null),f=r(!1),b=()=>{f.value=!0},y=r(!1);c([f,y],((e,a)=>{e.includes(!0)||(m.value=null)}));const k=[{title:"姓名",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"状态",dataIndex:"status",key:"status",customRender:e=>d(I,{checked:e.value,onChange:async a=>{x.confirm({title:"提示",content:"确定要"+(a?"启用":"禁用")+"该角色吗？",onOk:async()=>{(await U({id:e.record.id,status:a?1:0})).code||(p.success("操作成功"),e.record.status=a?1:0,x.destroyAll())}})},checkedValue:1,unCheckedValue:0,disabled:0===e.record.id},null)},{title:"操作",dataIndex:"action",key:"action",customRender:e=>d("div",{class:"flex flex-row gap-2"},[d(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{y.value=!0,m.value=e.id})(e),disabled:0===e.record.id},{default:()=>[n("查看账号")]}),d(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{m.value=e.id,f.value=!0})(e),disabled:0===e.record.id},{default:()=>[n("编辑")]})])}];return(e,o)=>{const r=t("a-button");return l(),w(C,null,[d(g,{columns:k,tableTitle:"角色管理",tableData:a.value,loading:s.value},{search:i((()=>[d(O,{onSearch:u,onReset:v})])),actions:i((()=>[d(r,{type:"primary",onClick:b},{default:i((()=>[n("新增角色")])),_:1})])),_:1},8,["tableData","loading"]),d(V,{visible:f.value,"onUpdate:visible":o[0]||(o[0]=e=>f.value=e),onAfterSave:v,id:m.value},null,8,["visible","id"]),d(A,{visible:y.value,"onUpdate:visible":o[1]||(o[1]=e=>y.value=e),id:m.value},null,8,["visible","id"])],64)}}};export{D as default};
