import{u as e}from"./useFormState-dDzhB8YD.js";import{n as a,O as l,r as t,o,d as s,w as i,c as d,e as u,h as n,N as r,y as c,P as v,i as m,v as p,p as b,j as f,U as _,t as y,f as k,Q as h,F as w,S as g,D as I}from"./index-DlcaZKbg.js";import{s as S,g as x,l as U,e as C,r as T}from"./user-CxSvkcge.js";import{g as F}from"./dict-D7SstXxP.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";const j={__name:"search",emits:["search","reset"],setup(c,{emit:v}){const m=v,{formState:p,setFormState:b,resetFormState:f}=e({name:void 0,mobile:void 0,status:void 0}),_=()=>{m("search",p)},y=()=>{f(),m("reset",p)},k=a([]);return l((()=>{y(),(async()=>{const e=await r({status:1}),{code:a,data:l}=e;a||(k.value=l)})()})),(e,a)=>{const l=t("a-select"),r=t("a-select-option"),c=t("SearchContainer");return o(),s(c,{labelWidth:"60",limitRows:"1",onSearch:_,onReset:y},{default:i((()=>[d(l,{label:"角色",placeholder:"请选择",value:u(p).roleId,"onUpdate:value":a[0]||(a[0]=e=>u(p).roleId=e),allowClear:"",options:k.value,fieldNames:{label:"name",value:"id"},optionFilterProp:"name"},null,8,["value","options"]),d(l,{label:"状态",placeholder:"请选择",value:u(p).status,"onUpdate:value":a[1]||(a[1]=e=>u(p).status=e),allowClear:""},{default:i((()=>[d(r,{value:1},{default:i((()=>[n("启用")])),_:1}),d(r,{value:0},{default:i((()=>[n("禁用")])),_:1})])),_:1},8,["value"])])),_:1})}}},O=e=>(b("data-v-95ddb9c9"),e=e(),f(),e),R=O((()=>m("div",{class:"title"},"用户信息",-1))),A={class:"grid grid-cols-2 gap-0"},L=O((()=>m("div",{class:"title"},"账号信息",-1))),M={class:"grid grid-cols-2 gap-0"},P=N({__name:"addUserModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(l,{emit:n}){const b=l,f=n,_=c({get:()=>b.visible,set(e){f("update:visible",e)}}),y=a(null),k=async()=>{if(await y.value.validate()){const e=await S(w),{code:a}=e;a||(p.success("保存成功"),f("afterSave"),h())}},h=()=>{I(),_.value=!1},{formState:w,patchFormState:g,resetFormState:I}=e({id:void 0,name:void 0,certType:void 0,certNo:void 0,mobile:void 0,email:void 0,account:void 0,roleIds:void 0,remark:void 0}),U=a([]),C=a([]);return v((()=>b.id),(async e=>{if((async()=>{const e=await r({status:1}),{code:a,data:l}=e;a||(U.value=l)})(),(async()=>{const e=await F({id:8}),{code:a,data:l}=e;a||(C.value=l.dataMapList)})(),e||0===e){const a=await x({id:e}),{code:l,data:t}=a;l||g(t)}}),{immediate:!0}),(e,a)=>{const l=t("a-input"),n=t("a-form-item"),r=t("a-select"),c=t("a-textarea"),v=t("a-form"),p=t("a-modal");return o(),s(p,{visible:_.value,"onUpdate:visible":a[8]||(a[8]=e=>_.value=e),title:"新增用户",onOk:k,onCancel:h,okText:"保存",width:"60%",destroyOnClose:!0,maskClosable:!1},{default:i((()=>[d(v,{ref_key:"userFormRef",ref:y,model:u(w),name:"user","label-col":{style:{width:"80px"}},"wrapper-col":{span:16},autocomplete:"off"},{default:i((()=>[R,m("div",A,[d(n,{label:"姓名",name:"name"},{default:i((()=>[d(l,{value:u(w).name,"onUpdate:value":a[0]||(a[0]=e=>u(w).name=e)},null,8,["value"])])),_:1}),d(n,{label:"证件类型",name:"certType"},{default:i((()=>[d(r,{value:u(w).certType,"onUpdate:value":a[1]||(a[1]=e=>u(w).certType=e),options:C.value,fieldNames:{label:"name",value:"id"},optionFilterProp:"name"},null,8,["value","options"])])),_:1}),d(n,{label:"证件号码",name:"certNo"},{default:i((()=>[d(l,{value:u(w).certNo,"onUpdate:value":a[2]||(a[2]=e=>u(w).certNo=e)},null,8,["value"])])),_:1}),d(n,{label:"手机号",name:"mobile"},{default:i((()=>[d(l,{value:u(w).mobile,"onUpdate:value":a[3]||(a[3]=e=>u(w).mobile=e)},null,8,["value"])])),_:1}),d(n,{label:"邮箱",name:"email"},{default:i((()=>[d(l,{value:u(w).email,"onUpdate:value":a[4]||(a[4]=e=>u(w).email=e)},null,8,["value"])])),_:1})]),L,m("div",M,[d(n,{label:"账号",name:"account",required:""},{default:i((()=>[d(l,{value:u(w).account,"onUpdate:value":a[5]||(a[5]=e=>u(w).account=e)},null,8,["value"])])),_:1}),d(n,{label:"角色",name:"roleIds",required:""},{default:i((()=>[d(r,{value:u(w).roleIds,"onUpdate:value":a[6]||(a[6]=e=>u(w).roleIds=e),mode:"multiple",options:U.value,showArrow:"",fieldNames:{label:"name",value:"id"},optionFilterProp:"name"},null,8,["value","options"])])),_:1}),d(n,{label:"账号说明",name:"remark",class:"col-span-2"},{default:i((()=>[d(c,{value:u(w).remark,"onUpdate:value":a[7]||(a[7]=e=>u(w).remark=e)},null,8,["value"])])),_:1})])])),_:1},8,["model"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-95ddb9c9"]]),z=e=>(b("data-v-c878b9ed"),e=e(),f(),e),D=z((()=>m("div",{class:"title"},"用户信息",-1))),V={class:"p-4"},q=z((()=>m("div",{class:"title"},"账号信息",-1))),B={class:"p-4"},Q={key:0,class:"ml-2 text-success"},W={key:1,class:"ml-2 text-danger"},Z=N({__name:"userInfoModal",props:{id:{type:String,default:void 0},visible:{type:Boolean,default:!1}},emits:["update:visible","afterSave"],setup(a,{emit:l}){const r=a,p=l,b=c({get:()=>r.visible,set(e){p("update:visible",e)}}),f=()=>{g(),b.value=!1},{formState:h,patchFormState:w,resetFormState:g}=e({name:void 0,certTypeName:void 0,certNo:void 0,mobile:void 0,email:void 0,account:void 0,status:void 0,createTime:void 0,updateTime:void 0,roleIds:void 0,roleList:[],remark:void 0});return v((()=>r.id),(async e=>{if(e||0===e){const a=await x({id:e}),{code:l,data:t}=a;l||w(t)}}),{immediate:!0}),_((()=>{g()})),(e,a)=>{const l=t("a-descriptions-item"),r=t("a-descriptions"),c=t("a-modal");return o(),s(c,{visible:b.value,"onUpdate:visible":a[0]||(a[0]=e=>b.value=e),title:"用户信息",onOk:f,okText:"关闭",width:"60%",destroyOnClose:!0,maskClosable:!1},{default:i((()=>[D,m("div",V,[d(r,null,{default:i((()=>[d(l,{label:"姓名"},{default:i((()=>[n(y(u(h).name||"--"),1)])),_:1}),d(l,{label:"证件类型"},{default:i((()=>[n(y(u(h).certTypeName||"--"),1)])),_:1}),d(l,{label:"证件号码"},{default:i((()=>[n(y(u(h).certNo||"--"),1)])),_:1}),d(l,{label:"手机号"},{default:i((()=>[n(y(u(h).mobile||"--"),1)])),_:1}),d(l,{label:"邮箱",name:"email"},{default:i((()=>[n(y(u(h).email||"--"),1)])),_:1})])),_:1})]),q,m("div",B,[d(r,null,{default:i((()=>[d(l,{label:"账号"},{default:i((()=>[n(y(u(h).account),1)])),_:1}),d(l,{label:"账号状态"},{default:i((()=>[1===u(h).status?(o(),k("span",Q,"启用")):(o(),k("span",W,"停用"))])),_:1}),d(l,{label:"角色"},{default:i((()=>[n(y(u(h).roleList.map((e=>e.name)).join(",")),1)])),_:1}),d(l,{label:"创建日期"},{default:i((()=>[n(y(u(h).createTime||"--"),1)])),_:1}),d(l,{label:"停用日期"},{default:i((()=>[n(y(1===u(h).status?"--":u(h).updateTime),1)])),_:1}),d(l,{label:"账号说明"},{default:i((()=>[n(y(u(h).remark||"--"),1)])),_:1})])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-c878b9ed"]]),E={__name:"userManage",setup(e){const l=a([]),s=a(!1),u=async e=>{s.value=!0;const a=await U(e),{code:t,data:o}=a;t||(l.value=o,s.value=!1)},r=e=>{u(e)},c=(e={})=>{u(e)},m=a(null),b=a(!1),f=()=>{b.value=!0},_=a(!1);v([_,b],(e=>{e[0]||e[1]||(m.value=null)}));const y=[{title:"账号",dataIndex:"account",key:"account"},{title:"姓名",dataIndex:"name",key:"name"},{title:"手机号",dataIndex:"mobile",key:"mobile"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"角色",dataIndex:"roleIds",key:"roleIds",customRender:e=>e.record.roleList.map((e=>e.name)).join(",")||"--"},{title:"状态",dataIndex:"status",key:"status",customRender:e=>d(g,{checked:e.value,onChange:async a=>{I.confirm({title:"提示",content:"确定要"+(a?"启用":"禁用")+"该用户吗？",onOk:async()=>{(await C({id:e.record.id,status:a?1:0})).code||(p.success("操作成功"),e.record.status=a?1:0,I.destroyAll())}})},checkedValue:1,unCheckedValue:0,disabled:0===e.record.id},null)},{title:"操作",dataIndex:"action",key:"action",customRender:e=>d("div",{class:"flex flex-row gap-2"},[d(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{m.value=e.id,_.value=!0})(e),disabled:0===e.record.id},{default:()=>[n("详情")]}),d(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{m.value=e.id,b.value=!0})(e),disabled:0===e.record.id},{default:()=>[n("编辑")]}),d(t("a-button"),{type:"link",size:"small",onClick:()=>(({record:e})=>{I.confirm({title:"提示",content:"确定重置密码吗？",onOk:async()=>{(await T({userId:e.id})).code||(p.success("重置成功"),I.destroyAll())}})})(e),style:"color: #ff4d4d",disabled:0===e.record.id},{default:()=>[n("重置密码")]})]),fixed:"right"}];return(e,a)=>{const u=t("a-button");return o(),k(w,null,[d(h,{columns:y,tableTitle:"用户管理",tableData:l.value,loading:s.value},{search:i((()=>[d(j,{onSearch:r,onReset:c})])),actions:i((()=>[d(u,{type:"primary",onClick:f},{default:i((()=>[n("新增用户")])),_:1})])),_:1},8,["tableData","loading"]),d(P,{visible:b.value,"onUpdate:visible":a[0]||(a[0]=e=>b.value=e),onAfterSave:c,id:m.value},null,8,["visible","id"]),d(Z,{visible:_.value,"onUpdate:visible":a[1]||(a[1]=e=>_.value=e),id:m.value},null,8,["visible","id"])],64)}}};export{E as default};
